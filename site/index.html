<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Poster</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <style type="text/css">
        body {
            padding: 20px;
        }

        .header {
            text-align: center;
            border-bottom: 1px solid #ccc;
        }

        .row {
            display: flex;
        }

        .left {
            width: 380px;
            border-right: 1px solid #ccc;
            margin-right: 20px;
        }

        form .row {
            line-height: 30px;
        }

        form label {
            vertical-align: top;
        }

        .footer, .footer a {
            font-size: 12px;
            color: #3a3a3a;
        }

        #parameterDocs{
            word-break: break-all;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>Simple poster generator</h1>
</div>
<div class="body">
    <div class="row">
        <div class="left column">
            <h2>Template parameter</h2>

            <form id="builder">
                <div class="row">
                    <div class="six columns">
                        <label for="template">Template</label>
                        <select class="u-full-width" id="template" onchange="handleTemplateChange()">
                            <option value="tw-poster-new">TW Poster</option>
                            <option value="article-cover">Article Cover</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="six columns">
                        <label>Parameter</label>
                        <textarea id="parameters" rows="12" cols="25" class="u-full-width"></textarea>
                    </div>
                </div>
                <button-groups>
                    <input type="button" onclick="preview()" value="Preview">
                    <input type="button" class="button-primary" onclick="download()" value="Download">
                </button-groups>
            </form>

            <h2>Template Parameters</h2>
            <div id="parameterDocs">

            </div>
        </div>
        <div class="right column">
            <h2>Preview Here</h2>
            <iframe id="preview" width="800" height="1150"
                    src="/preview?template=default&parameters=%7B%22content%22%3A%22Principles%20of%20architecture%3A%20trade-offs%20over%20absolutes%3B%20More%20right%20than%20right%3B%20Consensus%20over%20preference.%22%7D"
                    frameborder="0"></iframe>
        </div>
    </div>
    <div class="footer">
        Author：shaogefenhao <a href="http://shaogefenhao.com/">http://shaogefenhao.com/</a> Images from：<a href="https://unsplash.com/">https://unsplash.com/</a>
    </div>
</div>
<script type="text/javascript">
    // TODO，在模板中配置更多的元数据，直接读取模板中的数据
    const defaultParams = {
        "tw-poster-new": {
            "title": "Title noto serif sc black ",
            "subTitle": "Sub title noto serif sc bold word size 30pt light height 40pt",
            "content": "Content noto sans sc regular word size 30pt light height 40pt",
            "qrcode": "https://via.placeholder.com/140",
            "qrcodeDescription": "QrCode here",
            "header": "default",
        },
        "article-cover": {
            "title": "Article Title",
            "background": "https://s3.bmp.ovh/imgs/2022/02/7853688fffdc151f.jpeg"
        },
    }

    const paramsDefines = {
        "tw-poster-new": {
            "title": "Title noto serif sc black word size 100pt light height 130pt",
            "subTitle": "Sub title noto serif sc bold word size 30pt light height 40pt",
            "content": "Content noto sans sc regular word size 30pt light height 40pt",
            "qrcode": "URL for qrcode content",
            "header": "[default][tw_illustration_149][tw_illustration_150][tw_illustration_151][tw_illustration_152]"
        },
        "article-cover": {
            "title": "Title",
            "background": "Url for background"
        },
    }

    handleTemplateChange();

    function handleTemplateChange() {
        console.log(builder.template.value)
        builder.parameters.value = JSON.stringify(defaultParams[builder.template.value]);

        preview();
        renderParameterDoc();
    }

    function renderParameterDoc() {
        var docLine = [];
        for (var key in paramsDefines[builder.template.value]) {
            docLine.push(`<p>${key}:${paramsDefines[builder.template.value][key]}<p>`)
        }
        parameterDocs.innerHTML = docLine.join('\r\n');
    }

    function preview() {
        const formData = {
            template: builder.template.value,
            parameters: encodeURIComponent(builder.parameters.value)
        }
        const target = window.location.href + 'preview?template=' + formData.template + '&parameters=' + formData.parameters;
        window.frames[0].location.href = target;
        return formData.parameters;
    }

    function download() {
        let parameters = preview();
        window.open("/download?parameters=" + parameters + '&template=' + builder.template.value);
    }
</script>
</body>
</html>
